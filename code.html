<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Team Codes</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f7f7fb; padding: 32px; }
        .container { max-width: 420px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 16px #0001; padding: 32px; }
        label { display: block; margin: 12px 0 4px 0; font-weight: 600; }
        input, select { padding: 8px 12px; border-radius: 8px; border: 1px solid #a21272; font-size: 1rem; width: 100%; }
        button { margin-top: 18px; background: linear-gradient(90deg, #ff54d7 0%, #61c3ff 100%); color: #fff; font-weight: 600; border: none; border-radius: 8px; padding: 10px 18px; font-size: 1rem; cursor: pointer; width: 100%; }
        button:hover { background: linear-gradient(90deg, #61c3ff 0%, #ff54d7 100%); }
        .result { margin-top: 18px; background: #f0f0fa; border-radius: 8px; padding: 12px; font-size: 1.1rem; }
        .divider { margin: 28px 0 12px 0; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Create Team Codes</h2>
        <label for="team">Team</label>
        <select id="team">
            <option value="Pink">Pink</option>
            <option value="Blue">Blue</option>
        </select>
        <label for="count">Number of codes</label>
        <input type="number" id="count" min="1" max="5" value="1">
        <button id="create-btn">Create Codes</button>
        <div class="result" id="result"></div>
        <div class="divider"></div>
        <button id="start-btn" style="background:linear-gradient(90deg,#61c3ff 0%,#ff54d7 100%);margin-top:0;">Bắt đầu tất cả vào trận</button>
        <div class="result" id="start-result"></div>
    </div>
   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDocs, collection, getDoc } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";
    // --- Firebase config ---
    const firebaseConfig = {
      apiKey: "AIzaSyC5gM3sNfJnR88EilMA5EBG8qdxt5NSOjQ",
      authDomain: "chess-9bfbb.firebaseapp.com",
      projectId: "chess-9bfbb",
      storageBucket: "chess-9bfbb.appspot.com",
      messagingSenderId: "296757639984",
      appId: "1:296757639984:web:6a8933a6066222891be6f5",
      measurementId: "G-22T10D2S36"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById('create-btn').onclick = async () => {
        const team = document.getElementById('team').value;
        const count = parseInt(document.getElementById('count').value, 10);
        let codes = [];
        for (let i = 1; i <= count; i++) {
            const code = `${team.toUpperCase()}${String(i).padStart(2, '0')}`;
            await setDoc(doc(db, "users", code), {
                username: "",
                team: team
            });
            codes.push(code);
        }
        document.getElementById('result').innerHTML = 
            `<b>Created codes for team ${team}:</b><br>` + codes.join(', ');
    };

    // Nút bắt đầu tất cả vào trận
    document.getElementById('start-btn').onclick = async () => {
        await setDoc(doc(db, "chess_event", "status"), { started: true });

        // Tạo cặp đấu ngay lập tức
        const TEAMS = ['Pink', 'Blue'];
        let players = [];
        for (let team of TEAMS) {
            const teamRef = doc(db, "chess_teams", team);
            const teamSnap = await getDoc(teamRef);
            const members = teamSnap.exists() ? teamSnap.data().members || [] : [];
            for (let m of members) players.push({ ...m, team });
        }
        // Shuffle
        for (let i = players.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [players[i], players[j]] = [players[j], players[i]];
        }
        // Pair up (nếu lẻ thì người cuối không có cặp)
        const pairs = [];
        for (let i = 0; i < players.length - 1; i += 2) {
            pairs.push([players[i], players[i + 1]]);
        }
        await setDoc(doc(db, "chess_event", "pairs"), { pairs });

        document.getElementById('start-result').innerHTML = "<b>Đã gửi lệnh bắt đầu và ghép cặp!</b>";
    };
</script>
</body>
</html>